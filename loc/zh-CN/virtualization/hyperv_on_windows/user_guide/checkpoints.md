# 使用检查点还原到以前的状态的虚拟机

检查点都提供快速和容易的方法来恢复到以前的状态的虚拟机。


## 启用或禁用检查站

1.	在 * * HYPER-V 管理器 * *，右键单击虚拟机的名称，然后单击 * * 设置 * *。
2.	在 * * 管理 * * 部分中，选择 * * 检查站 * *。
3.	要允许检查站，摘下此虚拟机，请确保选中了启用检查点 — — 这是默认行为。 
要禁用检查点，请取消选择 * * 启用检查点 * * 复选框。
4.	单击 * * 应用 * * 以应用您的更改。如果你做，请单击 * * 好 * * 以关闭对话框。


## 选择标准或生产检查站

有两种类型的检查点:
*  * * 生产检查站 * * — — 主要在生产环境中，服务器上用作备份的一种形式。
*  * * 标准检查站 * * — — 在开发或测试环境中用于允许回滚，如果更改失败。 

两种类型的检查点将虚拟机还原到以前的状态。

生产检查点创建应用程序一致性检查点的虚拟机。  

标准检查站 (以前称为快照) 捕获您的虚拟机的确切内存状态。这意味着虚拟机将恢复与 * * 完全 * * 相同状态的检查点被带到确切的应用程序状态。 
标准的检查站可能包含有关客户端连接、 事务和外部的网络状态信息。应用检查点时，此信息就可能无效。

虚拟机标准检查点的存在可能会影响虚拟机的磁盘性能。


应用生产检查点涉及到从脱机状态启动来宾操作系统。 

下表显示何时使用生产检查站或标准检查点，根据虚拟机的状态。

|  * * 虚拟机状态 * * |* * 生产检查点 * * | * * 标准检查点 * * |
|:-----|:-----|:-----|
| * * 运行与集成服务 * * |是啊 |是啊 |
| * * 运行没有集成服务 * * |没有 |是啊 |
| * * 脱机-没有已保存的状态 * * |是啊 |是啊 |
| * * 脱机-与保存状态 * * |没有 |是啊 |
| * * 暂停 * * |No|是啊 |

若要查看标准和生产检查点之间的区别，看看 [检查站演练] (.../ quick_start/walkthrough_checkpoints.md)。

## 设置默认检查点类型

1.	在 * * HYPER-V 管理器 * *，右键单击虚拟机的名称，然后单击 * * 设置 * *。
2.	在 * * 管理 * * 部分中，选择 * * 检查站 * *。
3.	选择生产检查站或标准的检查站。
如果你选择生产检查站，你还可以指定是否宿主应采取标准的检查点，如果不能采取生产检查点。
4.	如果您想要更改存储配置文件检查点的位置，更改中的路径 * * 检查点文件位置 * * 节。
5.	单击 * * 应用 * * 以应用您的更改。如果你做，请单击 * * 好 * * 以关闭对话框。

新的虚拟机在 Windows 10 的默认行为是使用回退到标准检查点创建生产检查站


## 创建一个检查点
若要创建一个检查点
1.	在 * * HYPER-V 管理器 * * 之下，* * 虚拟机 * *，选择的虚拟机。
2.	右键单击虚拟机的名称，然后单击 * * * * 检查点。
3.	过程完成后，检查点将出现在下 * * 检查站 * * 中 * * HYPER-V 管理器 * *。 


## 应用一个检查站
如果你想要恢复到以前的时间点您的虚拟机，您可以应用现有的检查点。

1.	在 * * HYPER-V 管理器 * * 之下，* * 虚拟机 * *，选择的虚拟机。
2.	在检查站部分中，右键单击您想要使用，然后单击检查 * * 应用 * *。
3.	用下列选项将出现一个对话框: 

```	
**Create Checkpoint and Apply**: Creates a new checkpoint of the virtual machine before it applies the earlier checkpoint. 

**Apply**: Applies only the checkpoint that you have chosen. You cannot undo this action.

**Cancel**: Closes the dialog box without doing anything.
```

一检查点 # #Delete

要干净地删除检查点: 

1.	在 * * HYPER-V 管理器 * *，选择的虚拟机。
2.	在 * * 检查站 * * 节，右键单击您想要删除的检查站并单击删除。您还可以删除检查点和所有随后的检查站。要这样做，请右键单击您想要删除，然后单击最早检查站 * * * 删除检查点 * * 子树 * *。
3.	可能会要求您确认您要删除检查点。确认它是正确的检查点，然后单击 * * 删除 * *。 
4.	.Avhdx 和.vhdx 文件将合并，并且完成后，将从文件系统中删除.avhdx 文件。 

> * * 提示: * * 你可以使用 Windows Powershell 删除检查点通过使用 * * 删除-VMSnapshot * * cmdlet。 
 
 检查点是作为.avhdx 文件存储在虚拟机的.vhdx 文件相同的位置。
 

## 更改在哪里检查点设置和保存的状态文件的存储
如果虚拟机有没有检查点，您可以更改检查点配置和保存的状态文件的存储位置。

1.	在 * * HYPER-V 管理器 * *，右键单击虚拟机的名称，然后单击 * * 设置 * *。
	
2.	在 * * 管理 * * 部分中，选择 * * 检查站 * * 或 * * 检查点文件位置 * *。
	
4.	在 * * 检查点文件位置 * *，输入要将存储文件的文件夹的路径。
	
5.	单击 * * 应用 * * 以应用您的更改。如果你做，请单击 * * 好 * * 以关闭对话框。

用于存储检查点配置文件的默认位置是: %systemroot%\programdata\microsoft\windows\hyper-v\snapshots。


<!-- This belongs in dev docs

此文件夹将包含。VMRS 文件的运行时与保存的状态数据和。VMCX 配置文件，使用检查点 GUID 作为文件名称。
-->

## 重命名一个检查站

1.	在 * * HYPER-V 管理器 * *，选择的虚拟机。
2.	检查点，用鼠标右键单击，然后选择 * * * * 重命名。
3.	输入在检查点的新名称。
4.	单击 * * 输入 * * 当你完成。

默认情况下，检查点的名称是结合的日期和时间被采取的检查点的虚拟机的名称。 

```
virtual_machine_name (MM/DD/YYY –hh:mm:ss AM\PM)
```

名字是限于 100 个字符或更少，和名称不能为空。 


